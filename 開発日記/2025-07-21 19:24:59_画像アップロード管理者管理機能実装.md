# 2025-07-21 19:24:59: 画像アップロード・管理者管理機能実装

## 作業内容
- 画像アップロードAPIの実装（/api/upload）
- 画像アップロードコンポーネントの作成（単一・複数対応）
- キャスト管理画面への画像アップロード機能統合
- 画像削除APIの実装
- 管理者アカウント管理画面の完全実装（一覧・新規・編集・削除）
- 管理者管理用APIエンドポイントの実装

## 技術的な決定事項
- **画像アップロード**: Next.js標準のFormData APIを使用（外部ライブラリ不要）
- **ファイル保存**: publicディレクトリ（/public/images/casts/）
- **ファイル名**: UUID v4による一意性確保
- **画像検証**: ファイルタイプ（JPEG/PNG/WebP）とサイズ制限（5MB）
- **UI**: ドラッグ&ドロップ対応、プレビュー機能付き
- **管理者管理**: パスワードのbcryptハッシュ化、最後の管理者保護機能

## 課題と解決策
### 課題
- Next.js App Routerでのファイルアップロード実装方法
- 複数画像管理とメイン画像設定のUI/UX
- 管理者削除時の最後の管理者保護

### 解決策
- FormData APIとBuffer変換によるファイル保存実装
- 複数画像アップローダーコンポーネントで視覚的な管理UI実装
- データベースレベルでアクティブ管理者数をチェック

## 実装したコンポーネント・API
1. **画像アップロード機能**
   - `/api/upload` - 画像アップロードAPI
   - `/api/upload/delete` - 画像削除API
   - `ImageUploader` - 単一画像アップロードコンポーネント
   - `MultiImageUploader` - 複数画像アップロードコンポーネント

2. **管理者管理機能**
   - `/admin/admins` - 管理者一覧画面
   - `/admin/admins/new` - 新規管理者登録画面
   - `/admin/admins/[id]/edit` - 管理者編集画面
   - `/api/admins` - 管理者CRUD API

## 次回のタスク
- [ ] エラーハンドリングとバリデーションの強化
- [ ] パフォーマンス最適化とセキュリティ強化
- [ ] PWA対応（オフライン機能）の実装

## 参考リンク
- [Next.js File Uploads](https://nextjs.org/docs/app/building-your-application/routing/route-handlers#request-body-formdata)
- [Next.js Image Optimization](https://nextjs.org/docs/app/building-your-application/optimizing/images)